-- Add TB_MISC_VALUES

CREATE TABLE TB_MISC_VALUES (
  ID NUMBER(19) NOT NULL,
  NAME VARCHAR2(255 CHAR) NOT NULL,
  DATE_VALUE_TZ VARCHAR2(50 CHAR),
  DATE_VALUE TIMESTAMP,
  STRING_VALUE VARCHAR2(255 CHAR),
  UUID VARCHAR2(36 CHAR) NOT NULL,
  CREATED_DATE_TZ VARCHAR2(50 CHAR),
  CREATED_DATE TIMESTAMP,
  CREATED_BY VARCHAR2(50 CHAR),
  LAST_UPDATED_TZ VARCHAR2(50 CHAR),
  LAST_UPDATED TIMESTAMP,
  LAST_UPDATED_BY VARCHAR2(50 CHAR),
  VERSION NUMBER(19) NOT NULL
);

ALTER TABLE TB_MISC_VALUES ADD CONSTRAINT PK_TB_MISC_VALUES
	PRIMARY KEY (ID)
;

ALTER TABLE TB_MISC_VALUES
    ADD CONSTRAINT UQ_TB_MISC_VALUES UNIQUE (UUID)
;

ALTER TABLE TB_MISC_VALUES ADD CONSTRAINT TB_MISC_VALUES_NAME UNIQUE(NAME);

-- Insert value

-- Create GET_NEXT_SEQUENCE_VALUE function

CREATE OR REPLACE FUNCTION GET_NEXT_SEQUENCE_VALUE(sequence_name_in IN VARCHAR2)
  RETURN NUMBER
  IS sequence_next_value_out NUMBER(19,0);
  BEGIN
    SELECT SEQUENCE_NEXT_VALUE INTO sequence_next_value_out
    FROM TB_SEQUENCES 
    WHERE SEQUENCE_NAME = sequence_name_in;
    RETURN (sequence_next_value_out);
  END;
/

Insert into TB_SEQUENCES(SEQUENCE_NAME, SEQUENCE_NEXT_VALUE) VALUES ('MISC_VALUES', 1);

INSERT INTO TB_MISC_VALUES
(ID, NAME, DATE_VALUE_TZ, DATE_VALUE, STRING_VALUE, 
 UUID, CREATED_DATE_TZ, CREATED_DATE, CREATED_BY, LAST_UPDATED_TZ, LAST_UPDATED, LAST_UPDATED_BY, VERSION)
VALUES
 (GET_NEXT_SEQUENCE_VALUE('MISC_VALUES'), 'variable_element.geographical_information.last_updated_date', 'Europe/London', to_timestamp(sysdate,'DD/MM/RR HH24:MI:SS,FF'), null,
 GET_NEXT_SEQUENCE_VALUE('MISC_VALUES'), 'Europe/London', to_timestamp(sysdate,'DD/MM/RR HH24:MI:SS,FF'), 'Metamac', 'Europe/London', to_timestamp(sysdate,'DD/MM/RR HH24:MI:SS,FF'), 'Metamac', 1);

UPDATE TB_SEQUENCES SET SEQUENCE_NEXT_VALUE = SEQUENCE_NEXT_VALUE + 1 WHERE SEQUENCE_NAME = 'MISC_VALUES';

commit;

DROP FUNCTION GET_NEXT_SEQUENCE_VALUE;

